{# templates/batch_report_template.html #}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./static/css/style.css">
    <title>data_release_report</title>
</head>
<body>
   
   <table style="width=100%; font-family: Arial, Helvetica, sans-serif; bottom-margin:50px">
   <tr>
     <td style="width: 40%; padding: 3px; text-align: left"><img src="./static/images/OICR_Logo_RGB_ENGLISH.png" alt="OICR_logo" title="OICR_logo" style="padding-right: 8px; padding-left:0px; width:10; height:10"></td>
     <td style="width: 60%; padding: 3px; text-align: left"><p style="text-align: center; color: black; font-size:45px; font-family: Arial, Verdana, sans-serif; font-weight:bold">Data Release Report</p></td>
   </tr>
   </table>
   
   
   <table id="project_table">
   <tr>
     <th>Project Acronym</th>
     <th>Project Name</th>
     <th>Date</th>     
   </tr>   
   {% for i in projects %}   
     <tr>       
       <td> {{ i['acronym'] }} </td>
       <td> {{ i['name'] }} </td>        
       <td> {{ i['date'] }} </td>
     </tr>
   {% endfor %}   
   </table>
    
   <p>This report provides detailed sample information and QC metrics about newly released raw sequences.</p>
   
   <h2>1. File Count</h2>
   <p>This release includes {{file_count}} pairs of fastq files. File count is broken down by instrument and run as follow.</p>
   
   <table id="info_table">
   <tr>
     <th>Platform</th>
     <th>Run</th>
     <th>Paired fastq files</th>     
   </tr>   
   <tr>   
   {% for instrument in fastq_counts %}
   </tr>
       {% for run in fastq_counts[instrument] %}
         <tr>           
           <td> {{instrument}} </td>
           <td> {{run}} </td>
           <td> {{fastq_counts[instrument][run]}} </td> 
           {% endfor %}                    
         </tr>        
       {% endfor %}               
                    
  </table>

  <div style="page-break-after: always;"></div>


  <h2>2. QC plots</h2>
            
  {% if plots %}      
    <p>QC plots are reported by instrument. Lines are the median of each metric. <span style="font-style: italic">Read count</span> is plotted by ascending order. Other metrics are plotted according to the order of <span style="font-style: italic">read counts</span></p>
    <br>
    {% if samples_missing_metrics %}   
      <p>Some samples could not be plotted because of missing QC values. Missing QC values appear as NA in the QC tables below. The number of discarded samples for each instrument is:</p>
      {% for instrument in samples_missing_metrics %}      
        <li> {{instrument}}: {{samples_missing_metrics[instrument]}} </li>
      {% endfor %}               
    {% endif %}
    
    {% for figure in plots %}
      <img src="{{figure}}" title="metrics_plot" alt="QC_plot" style="padding-right: 2px; padding-left:0px; width:5; height:5"/>
          
    {% endfor %}
    </table>  
    {% else %}
    <p>Data could not be plotted because of missing QC metrics</p>
     
  {% endif %}


  <div class="landscape">
  
  <h2>Table 1. Sample identifiers</h2>
  <p>Table 1 provides information about the sequenced samples.</p>
  <p>S: Library type, T: Tissue type, O: Tissue origin</p>
     

   <table id="info_table">
   <tr>
     <th>{{header_identifiers.0}}</th>
     <th>{{header_identifiers.1}}</th>
     <th>{{header_identifiers.2}}</th>
     <th>{{header_identifiers.3}}</th>
     <th>{{header_identifiers.4}}</th>
     <th>{{header_identifiers.5}}</th>
     <th>{{header_identifiers.6}}</th>
   </tr>   
   <tr>   
   {% for instrument in sample_identifiers %}
   </tr>
       {% for i in sample_identifiers[instrument] %}
         <tr>
           <td> {{i.0}} </td>
           <td> {{i.1}} </td>
           <td> {{i.2}} </td>
           <td> {{i.3}} </td>
           <td> {{i.4}} </td>
           <td> {{i.5}} </td>
           <td> {{i.6}} </td>         
         </tr>        
       {% endfor %}               
  {% endfor %}
</table>

  <h3>Appendix Table 1</h3>

  <ul>
    <li><i>Library Type:</i> {{appendix_identifiers["Library Type"]}}</li>
    <li><i>Tissue Type:</i> {{appendix_identifiers["Tissue Type"]}}</li>
    <li><i>Tissue Origin:</i> {{appendix_identifiers["Tissue Origin"]}}</li>
  </ul>
  
  <p style="page-break-before: always;"></p>

  <h2>Table 2. QC metrics</h2>
  <p>Table 2 provides QC metrics about the raw sequences of each sample.</p>
  
  <table id="info_table">
   <tr>
     <th>{{header_metrics.0}}</th>
     <th>{{header_metrics.1}}</th>
     <th>{{header_metrics.2}}</th>
     <th>{{header_metrics.3}}</th>
     <th>{{header_metrics.4}}</th>
     <th>{{header_metrics.5}}</th>
     <th>{{header_metrics.6}}</th>
   </tr>   
   <tr>   
   {% for instrument in qc_metrics %}
   </tr>
       {% for i in qc_metrics[instrument] %}
         <tr>
           <td> {{i.0}} </td>
           <td> {{i.1}} </td>
           <td> {{i.2}} </td>
           <td> {{i.3}} </td>
           <td> {{i.4}} </td>
           <td> {{i.5}} </td>
           <td> {{i.6}} </td>         
         </tr>        
       {% endfor %}               
  {% endfor %}
</table>


  <h3>Appendix Table 2</h3>

  <ul>
    <li><i>Raw Coverage:</i> An estimate of the mean depth of coverage in the target space = total bases on target / size of the target space.</li>
    <li><i>On Target Rate:</i> Percentage of reads that overlap the target space by at least one base = reads on target/total reads.</li>
    <li><i>Percent duplicate:</i> Percent of duplicate reads estimated by Picard MarkDuplicates.</li>
  </ul>

  </div>

  <div style="page-break-before: always;"></div>
 
  <h2>Table 3. List of md5sums</h2>
  <p>A list of md5sums is available in the accompanying file: <span style="color: black; font-style: italic">{{md5sum}}</span></p>
    
</body>
</html>
